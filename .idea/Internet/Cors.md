CORS : 교차 출처 리소스 공유

서버 도메인과 다른 도메인에서 서버에 있는 리소스를 요청할 때, 브라우저에서는 보안상의 이유로 HTTP 요청을 제한한다.

다른 도메인에서 해당 서버에 무조건적으로 접근해서 리소스를 가져갈 수 있다면, 서버 입장에서는 비용도 증가하고, 데이터가 침해당할 수 있기 때문이다.

​

다른 도메인의 리소스를 접근하고자 할 때, 브라우저는 해당 요청이 simple requests 인지를 판단한다.

simple ruquests 는 해당 조건을 모두 충족할 때, CORS 에 위배되지 않고 브라우저가 서버에 요청을 보내는 requests 를 말한다.

그 외의 요청은 모두 요청 이전에 preflight 라고 불리우는 사전 요청을 통해서 해당 요청에 대한 유효성을 검증 받아야 한다.

따라서, 우리가 서버에 무언가를 요구하는 대부분의 행동은 CORS 에 걸린다.

​

CORS 를 해결하기 위해서는 서버에서 설정을 해줘야 한다.

그러면, preflight 에서 어떻게 본 요청에 대한 유효성을 검증받는지를 알아보자.

preflight 요청은 'Options' 메서드로 나간다.  Options 메서드는 preflight 를 위한 특수한 메서드이다.

서버에선 Options 메서드를 통해 해당 요청이 preflight 임을 알 수 있다.

이 요청에는 origin 항목이 있다. origin 항목은 요청이 날라온 도메인을 가리키는데, 서버에서는 이 도메인을 바탕으로 내가 자원 공유를 해줘도 되는 도메인인지 판단할 수 있다.

​

서버는 "Access-Control-Allow-Origin" 헤더로 자원 공유를 해줘도 되는 도메인의 목록을 브라우저에게 알려준다.

브라우저는 해당 헤더의 내용을 보고, 지금 도메인이 본 요청을 날릴 수 있는 도메인인지 판단을 하고 서버에 요청을 보낸다.

띠리사. 서버에서는 Access-Control-Allow-Origin 에 대한 설정을 하는 것으로 cors 접근을 허용할 수 있다.

이 외에도, "Access-Control-Allow-Methods" 헤더 설정을 통해 어떤 메서드만 허용할 것인지를 정하거나, 다른 헤더 설정을 통해 인증이 유효한 시간을 정하는 등 다양한 헤더 설정이 있다.

​

내가 문제를 해결한 방법은 filter 설정을 통해서 해결한 방법이었다.

webconfigue 를 해도 되고, 컨트롤러에 접근을 허용하는 @ 을 붙이는 해결방법도 있겠지만, 나는 filter 단에서 preflight 에 대한 헤더를 설정하는 것으로 해결해보고자 한다.